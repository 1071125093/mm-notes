"use strict";(self.webpackChunkmm_notes=self.webpackChunkmm_notes||[]).push([[554],{3867:(s,n,a)=>{a.r(n),a.d(n,{data:()=>l});const l=JSON.parse('{"key":"v-7ee8b8b0","path":"/source-code/only-allow.html","title":"only-allow","lang":"zh-CN","frontmatter":{},"excerpt":"","headers":[{"level":2,"title":"only-allow 使用方式","slug":"only-allow-使用方式","children":[{"level":3,"title":"npm 钩子说明","slug":"npm-钩子说明","children":[]}]},{"level":2,"title":"only-allow 源码笔记","slug":"only-allow-源码笔记","children":[]},{"level":2,"title":"which-pm-runs 源码笔记","slug":"which-pm-runs-源码笔记","children":[]}],"git":{"updatedTime":1672904385000},"filePathRelative":"source-code/only-allow.md"}')},2072:(s,n,a)=>{a.r(n),a.d(n,{default:()=>x});var l=a(6252);const p=(0,l._)("h1",{id:"only-allow",tabindex:"-1"},[(0,l._)("a",{class:"header-anchor",href:"#only-allow","aria-hidden":"true"},"#"),(0,l.Uk)(" only-allow")],-1),e={href:"https://github.com/pnpm/only-allow",target:"_blank",rel:"noopener noreferrer"},o=(0,l.Uk)("only-allow"),c=(0,l.Uk)(" 用于强制在项目中使用特定的包管理器"),r=(0,l.uE)('<h2 id="only-allow-使用方式" tabindex="-1"><a class="header-anchor" href="#only-allow-使用方式" aria-hidden="true">#</a> only-allow 使用方式</h2><p>在 <code>package.json</code> 中添加 <code>preinstall</code> 钩子，以 <code>npm</code> 为例</p><div class="language-json ext-json line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;scripts&quot;</span><span style="color:#D4D4D4;">: {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;preinstall&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;npx only-allow npm&quot;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="npm-钩子说明" tabindex="-1"><a class="header-anchor" href="#npm-钩子说明" aria-hidden="true">#</a> npm 钩子说明</h3><p>在 <code>npm</code> 脚本中有 <code>pre</code> 和 <code>post</code> 两个钩子</p><p>比如 <code>build</code> 脚本命令的钩子就是 <code>prebuild</code> 和 <code>postbuild</code></p><div class="language-json ext-json line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">{</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">&quot;scripts&quot;</span><span style="color:#D4D4D4;">: {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;prebuild&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;echo I run before the build script&quot;</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;build&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;vue-cli-service build&quot;</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">&quot;postbuild&quot;</span><span style="color:#D4D4D4;">: </span><span style="color:#CE9178;">&quot;echo I run after the build script&quot;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当用户执行 <code>npm run build</code> 时会按如下顺序执行</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#D4D4D4;">npm run prebuild &amp;&amp; npm run build &amp;&amp; npm run postbuild</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="相关资料" tabindex="-1"><a class="header-anchor" href="#相关资料" aria-hidden="true">#</a> 相关资料</h4>',10),D={href:"https://github.com/maomao1996/daily-notes/issues/20",target:"_blank",rel:"noopener noreferrer"},i=(0,l.Uk)("使用 npm 脚本钩子"),t=(0,l._)("h2",{id:"only-allow-源码笔记",tabindex:"-1"},[(0,l._)("a",{class:"header-anchor",href:"#only-allow-源码笔记","aria-hidden":"true"},"#"),(0,l.Uk)(" only-allow 源码笔记")],-1),y={class:"custom-container tip"},d=(0,l._)("p",{class:"custom-container-title"},"前置知识",-1),v={href:"https://github.com/zkochan/packages/tree/main/which-pm-runs",target:"_blank",rel:"noopener noreferrer"},u=(0,l.Uk)("which-pm-runs"),m=(0,l.Uk)(" 用于获取当前所使用的包管理器名称和版本（"),C=(0,l._)("a",{href:"#which-pm-runs-%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0"},"which-pm-runs 源码笔记",-1),b=(0,l.Uk)("）"),E={href:"https://github.com/sindresorhus/boxen",target:"_blank",rel:"noopener noreferrer"},h=(0,l.Uk)("boxen"),F=(0,l.Uk)(" 用于终端输出美化：在终端中生成一个方框图案"),A=(0,l._)("li",null,[(0,l._)("code",null,"process.argv"),(0,l.Uk)(" 属性返回的是一个数组，包含了启动 Node 进程时的命令行参数 "),(0,l._)("ul",null,[(0,l._)("li",null,"第一个元素是 process.execPath 即启动 Node 进程的可执行文件所在的绝对路径"),(0,l._)("li",null,"第二个元素是当前执行的 JavaScript 脚本的文件路径"),(0,l._)("li",null,"剩余的元素是在命令中传入的参数")])],-1),g=(0,l.uE)('<blockquote><p><strong>当前 only-allow 源码版本为 v1.1.1</strong></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;">#!/usr/bin/env node</span></span>\n<span class="line"><span style="color:#6A9955;">// 用于获取当前所使用的包管理器名称和版本</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">whichPMRuns</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;which-pm-runs&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#6A9955;">// 终端输出美化：在终端中生成一个方框图案</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">boxen</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">require</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;boxen&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">// 通过 process.argv 获取传入的参数</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">argv</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">argv</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">slice</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">2</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">// 对参数进行校验，为空时提示可使用的包管理器 &lt;npm|cnpm|pnpm|yarn&gt; 并退出进程</span></span>\n<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">argv</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> === </span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">&#39;Please specify the wanted package manager: only-allow &lt;npm|cnpm|pnpm|yarn&gt;&#39;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  )</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">exit</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">// 获取指定使用的包管理器，如果不是 npm|cnpm|pnpm|yarn 其中之一时提示当前可用的包管理器并退出进程</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">wantedPM</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">argv</span><span style="color:#D4D4D4;">[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>\n<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#D4D4D4;"> !== </span><span style="color:#CE9178;">&#39;npm&#39;</span><span style="color:#D4D4D4;"> &amp;&amp;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#D4D4D4;"> !== </span><span style="color:#CE9178;">&#39;cnpm&#39;</span><span style="color:#D4D4D4;"> &amp;&amp;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#D4D4D4;"> !== </span><span style="color:#CE9178;">&#39;pnpm&#39;</span><span style="color:#D4D4D4;"> &amp;&amp;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#D4D4D4;"> !== </span><span style="color:#CE9178;">&#39;yarn&#39;</span></span>\n<span class="line"><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#CE9178;">`&quot;</span><span style="color:#569CD6;">${</span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#569CD6;">}</span><span style="color:#CE9178;">&quot; is not a valid package manager. Available package managers are: npm, cnpm, pnpm, or yarn.`</span></span>\n<span class="line"><span style="color:#D4D4D4;">  )</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">exit</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">// 获取当前所使用的包管理器名称和版本</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">usedPM</span><span style="color:#D4D4D4;"> = </span><span style="color:#DCDCAA;">whichPMRuns</span><span style="color:#D4D4D4;">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#CE9178;">&#39;process.env.npm_config_user_agent&#39;</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">npm_config_user_agent</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">usedPM</span></span>\n<span class="line"><span style="color:#D4D4D4;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">// 获取 Node 进程当前工作的目录（即项目目录）</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">cwd</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#4FC1FF;">INIT_CWD</span><span style="color:#D4D4D4;"> || </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">cwd</span><span style="color:#D4D4D4;">()</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">/**</span></span>\n<span class="line"><span style="color:#6A9955;"> * 用于判断 only-allow 是否作为依赖项安装，保证只在运行项目依赖项安装时进行包管理器验证</span></span>\n<span class="line"><span style="color:#6A9955;"> * https://github.com/pnpm/only-allow/issues/2</span></span>\n<span class="line"><span style="color:#6A9955;"> */</span></span>\n<span class="line"><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">isInstalledAsDependency</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">cwd</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">includes</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;node_modules&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">// 当前进程的使用的包管理器与指定包管理器不一致时，根据指定的包管理器弹出错误提示并退出进程</span></span>\n<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">usedPM</span><span style="color:#D4D4D4;"> &amp;&amp; </span><span style="color:#9CDCFE;">usedPM</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> !== </span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#D4D4D4;"> &amp;&amp; !</span><span style="color:#9CDCFE;">isInstalledAsDependency</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">boxenOpts</span><span style="color:#D4D4D4;"> = { </span><span style="color:#9CDCFE;">borderColor:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;red&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">borderStyle:</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;double&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">padding:</span><span style="color:#D4D4D4;"> </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;"> }</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">switch</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">wantedPM</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">case</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;npm&#39;</span><span style="color:#D4D4D4;">:</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#DCDCAA;">boxen</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Use &quot;npm install&quot; for installation in this project&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">boxenOpts</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">      )</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">break</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">case</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;cnpm&#39;</span><span style="color:#D4D4D4;">:</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#DCDCAA;">boxen</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;Use &quot;cnpm install&quot; for installation in this project&#39;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">boxenOpts</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">      )</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">break</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">case</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;pnpm&#39;</span><span style="color:#D4D4D4;">:</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#DCDCAA;">boxen</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#CE9178;">`Use &quot;pnpm install&quot; for installation in this project.</span></span>\n<span class="line"><span style="color:#CE9178;">If you don&#39;t have pnpm, install it via &quot;npm i -g pnpm&quot;.</span></span>\n<span class="line"><span style="color:#CE9178;">For more details, go to https://pnpm.js.org/`</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">boxenOpts</span></span>\n<span class="line"><span style="color:#D4D4D4;">        )</span></span>\n<span class="line"><span style="color:#D4D4D4;">      )</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">break</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">case</span><span style="color:#D4D4D4;"> </span><span style="color:#CE9178;">&#39;yarn&#39;</span><span style="color:#D4D4D4;">:</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#9CDCFE;">console</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">log</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">        </span><span style="color:#DCDCAA;">boxen</span><span style="color:#D4D4D4;">(</span></span>\n<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#CE9178;">`Use &quot;yarn&quot; for installation in this project.</span></span>\n<span class="line"><span style="color:#CE9178;">If you don&#39;t have Yarn, install it via &quot;npm i -g yarn&quot;.</span></span>\n<span class="line"><span style="color:#CE9178;">For more details, go to https://yarnpkg.com/`</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">          </span><span style="color:#9CDCFE;">boxenOpts</span></span>\n<span class="line"><span style="color:#D4D4D4;">        )</span></span>\n<span class="line"><span style="color:#D4D4D4;">      )</span></span>\n<span class="line"><span style="color:#D4D4D4;">      </span><span style="color:#C586C0;">break</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">exit</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="which-pm-runs-源码笔记" tabindex="-1"><a class="header-anchor" href="#which-pm-runs-源码笔记" aria-hidden="true">#</a> which-pm-runs 源码笔记</h2>',3),w={href:"https://github.com/zkochan/packages/tree/main/which-pm-runs",target:"_blank",rel:"noopener noreferrer"},_=(0,l.Uk)("which-pm-runs"),k=(0,l.Uk)(" 用于获取当前所使用的包管理器名称和版本"),f=(0,l.uE)('<div class="custom-container tip"><p class="custom-container-title">process.env.npm_config_user_agent</p><p><code>process.env.npm_config_user_agent</code> 可以获取当前所使用的包管理器名称和版本，其格式如下</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#6A9955;"># npm</span></span>\n<span class="line"><span style="color:#CE9178;">&#39;npm/8.19.2 node/v18.11.0 darwin x64 workspaces/false&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;"># yarn</span></span>\n<span class="line"><span style="color:#CE9178;">&#39;yarn/1.22.11 npm/? node/v18.11.0 darwin x64&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;"># pnpm</span></span>\n<span class="line"><span style="color:#CE9178;">&#39;pnpm/7.12.1 npm/? node/v14.19.2 darwin x64&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;"># cnpm</span></span>\n<span class="line"><span style="color:#CE9178;">&#39;npminstall/6.6.2 npm/? node/v18.11.0 darwin x64&#39;</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><blockquote><p><strong>当前 which-pm-runs 源码版本为 v1.1.0</strong></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#1E1E1E;"><code><span class="line"><span style="color:#CE9178;">&#39;use strict&#39;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#6A9955;">/**</span></span>\n<span class="line"><span style="color:#6A9955;"> * 对 process.env.npm_config_user_agent 做字符串切割，最终返回一个对象</span></span>\n<span class="line"><span style="color:#6A9955;"> * 以 &#39;npm/8.19.2 node/v18.11.0 darwin x64 workspaces/false&#39; 为例</span></span>\n<span class="line"><span style="color:#6A9955;"> */</span></span>\n<span class="line"><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">pmFromUserAgent</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">userAgent</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 获取 npm 相关信息 =&gt; &#39;npm/8.19.2&#39;</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">pmSpec</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">userAgent</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">split</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39; &#39;</span><span style="color:#D4D4D4;">)[</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">]</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 获取 &#39;/&#39; 最后一次出现的索引 =&gt; 3</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">separatorPos</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">pmSpec</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">lastIndexOf</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&#39;/&#39;</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 提取 name</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#569CD6;">const</span><span style="color:#D4D4D4;"> </span><span style="color:#4FC1FF;">name</span><span style="color:#D4D4D4;"> = </span><span style="color:#9CDCFE;">pmSpec</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">substring</span><span style="color:#D4D4D4;">(</span><span style="color:#B5CEA8;">0</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">separatorPos</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 对 cnpm 做兼容处理</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">name:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;"> === </span><span style="color:#CE9178;">&#39;npminstall&#39;</span><span style="color:#D4D4D4;"> ? </span><span style="color:#CE9178;">&#39;cnpm&#39;</span><span style="color:#D4D4D4;"> : </span><span style="color:#9CDCFE;">name</span><span style="color:#D4D4D4;">,</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#6A9955;">// 提取 version</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#9CDCFE;">version:</span><span style="color:#D4D4D4;"> </span><span style="color:#9CDCFE;">pmSpec</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">substring</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">separatorPos</span><span style="color:#D4D4D4;"> + </span><span style="color:#B5CEA8;">1</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#4EC9B0;">module</span><span style="color:#D4D4D4;">.</span><span style="color:#4EC9B0;">exports</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">function</span><span style="color:#D4D4D4;"> () {</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 当 process.env.npm_config_user_agent 不存在时返回 undefined</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (!</span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">npm_config_user_agent</span><span style="color:#D4D4D4;">) {</span></span>\n<span class="line"><span style="color:#D4D4D4;">    </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#569CD6;">undefined</span></span>\n<span class="line"><span style="color:#D4D4D4;">  }</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#6A9955;">// 返回 pmFromUserAgent 函数处理的结果</span></span>\n<span class="line"><span style="color:#D4D4D4;">  </span><span style="color:#C586C0;">return</span><span style="color:#D4D4D4;"> </span><span style="color:#DCDCAA;">pmFromUserAgent</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">process</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">env</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">npm_config_user_agent</span><span style="color:#D4D4D4;">)</span></span>\n<span class="line"><span style="color:#D4D4D4;">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',3),q={},x=(0,a(3744).Z)(q,[["render",function(s,n){const a=(0,l.up)("ExternalLinkIcon");return(0,l.wg)(),(0,l.iD)("div",null,[p,(0,l._)("p",null,[(0,l._)("a",e,[o,(0,l.Wm)(a)]),c]),r,(0,l._)("p",null,[(0,l._)("a",D,[i,(0,l.Wm)(a)])]),t,(0,l._)("div",y,[d,(0,l._)("ul",null,[(0,l._)("li",null,[(0,l._)("a",v,[u,(0,l.Wm)(a)]),m,C,b]),(0,l._)("li",null,[(0,l._)("a",E,[h,(0,l.Wm)(a)]),F]),A])]),g,(0,l._)("p",null,[(0,l._)("a",w,[_,(0,l.Wm)(a)]),k]),f])}]])},3744:(s,n)=>{n.Z=(s,n)=>{const a=s.__vccOpts||s;for(const[s,l]of n)a[s]=l;return a}}}]);